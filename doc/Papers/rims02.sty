% LateX2e Style File for "数理解析研究所講究録 (Rims Kyoto)"
%    published by Research Institure for Mathematical Sciences, Kyoto Univ.
%
% rims.sty
%      version 3.0: Jan. 2002
%      by Tomokatsu Saito saito@@a2z.co.jp
%
% Usage::
%
%   You make headline.tex. This file include next items.
%   \title{原稿のタイトル}
%   \etitle{English Title}
%   \author{著者1\affil{所属}\mail{E-mail address}%
%                \ename{English name}\eaffil{English} \and
%           著者2\affil{所属}\mail{E-mail address}%
%                \ename{English name}\eaffil{English} ...}
%
%   And, paper body, Main file preable only include 
%   \usepackage[option]{rims}.
%
%   \documentclass{jarticle}
%   \usepackage[option]{rims}
%   \begin{document}
%% Option setting
%  English, FVerb, useeps, theorem
%  You don't write \maketitle.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newif\ifLang
\newif\iffancybox
\newif\ifgraphics
\newif\iftheorem
\DeclareOption{English}{\Langtrue}
\DeclareOption{FVerb}{\fancyboxtrue}
\DeclareOption{useeps}{\graphicstrue}
\DeclareOption{theorem}{\theoremtrue}
\ProcessOptions\relax
\iffancybox\RequirePackage{fancybox}\fi
\ifgraphics\RequirePackage[dvips]{graphics}\fi
\iftheorem\RequirePackage{theorem}\fi
%
%%  Page dimensions
%
\setcounter{@paper}{1}%
\setlength\paperheight{296mm}
\setlength\paperwidth{210mm}
%\tombowtrue \tombowdatetrue
\tombowfalse
\setlength{\@tombowwidth}{.1\p@}%
\@bannertoken{%
  \jobname\space:\space\number\year/\number\month/\number\day
   (\number\hour:\number\minute)}
%\maketombowbox
\textheight=226mm
\textwidth=160mm
\topmargin=-7mm
\oddsidemargin=-5mm
%\setlength{\hoffset}{-0.5in}
\setlength{\evensidemargin}{\oddsidemargin}
\footnotesep=9pt
%
\ifLang% English mode
\typeout{English Mode}
  \global\parindent=1.5em \global\leftmargini=1.5em
  \global\leftmarginii=1.25em \global\leftmarginiii=1.0em
  \global\leftmarginiv=1.0em \global\leftmarginv=1.0em
  \global\baselineskip=12pt
  \gdef\the@ck{Acknowledgements}
  \gdef\the@ref{References}
  \iftheorem
  \theoremstyle{break} \newtheorem{Th}{Theorem}
  \theoremstyle{break} \newtheorem{Pro}[Th]{Proposition}
  \theoremstyle{break} \newtheorem{Lem}[Th]{Lemma}
  \theoremstyle{break} \newtheorem{Cor}[Th]{Corollary}
  \theoremstyle{break} \newtheorem{Def}[Th]{Definition}
  \theoremstyle{break} \newtheorem{Hyp}[Th]{Hypothesis}
  \theoremstyle{break} \newtheorem{Nte}{Notation}
  \theoremstyle{break} \newtheorem{Exp}{Example}
  \theoremstyle{break} \newtheorem{Rem}{Remark}
  \theoremstyle{break} \newtheorem{Prob}{Problem}
  \theoremstyle{break} \newtheorem{Alg}{Algorithm}
  \newenvironment{Proof}%
  {\par{\bf Proof }}{\hfill\hbox{\rule[-2pt]{3pt}{6pt}}\par}
  \fi
  \renewcommand\figurename{Figure}
  \renewcommand\listfigurename{List of Figures}
  \renewcommand\tablename{Table}
  \renewcommand\listtablename{List of Tables}
\else% Japanese mode
\typeout{Japanese Mode}
  \global\parindent=1zw
  \global\baselineskip=15.65pt
  \gdef\the@ck{謝　　辞}
  \gdef\the@ref{参　考　文　献}
  \iftheorem
  \theoremstyle{break} \newtheorem{Th}{定理}
  \theoremstyle{break} \newtheorem{Pro}[Th]{命題}
  \theoremstyle{break} \newtheorem{Lem}[Th]{補題}
  \theoremstyle{break} \newtheorem{Cor}[Th]{系}
  \theoremstyle{break} \newtheorem{Def}[Th]{定義}
  \theoremstyle{break} \newtheorem{Hyp}[Th]{仮定}
  \theoremstyle{break} \newtheorem{Nte}{記法}
  \theoremstyle{break} \newtheorem{Exp}{例}
  \theoremstyle{break} \newtheorem{Rem}{注意}
  \theoremstyle{break} \newtheorem{Prob}{問題}
  \theoremstyle{break} \newtheorem{Alg}{アルゴリズム}
  \newenvironment{Proof}%
  {\par{\bf 証明 }}{\hfill\hbox{\rule[-2pt]{3pt}{6pt}}\par}
  \fi
\fi
%
%% Define some macros
%
\ifgraphics%
  \def\Eps#1{\includegraphics{#1}}
\fi
\iffancybox%
  \newenvironment{FVerb}[1]%
{\VerbatimEnvironment%
  \begin{Sbox}\begin{minipage}{#1}\begin{Verbatim}}%
      {\end{Verbatim}\end{minipage}\end{Sbox}%
  \setlength{\fboxsep}{3mm}\vspace*{4mm}\fbox{\TheSbox}}
\fi
\long\def\ifundefined#1#2#3{%
 \expandafter\ifx\csname #1\endcsname\relax #2\else #3\fi}
%%\def\affil#1{\\[-1.5ex]\small #1}
\def\affil#1{\\ #1}
%%\def\ename#1{\\[-1.5ex]\footnotesize\scshape #1}
%%\def\eaffil#1{\\[-1.5ex]\footnotesize\scshape #1}
\def\ename#1{\\[-0.5ex]\normalsize\scshape #1}
\def\eaffil#1{\\[-0.5ex]\normalsize\scshape #1}
\def\author#1{\gdef\@author{#1}}
\def\etitle#1{\gdef\@etitle{#1}}
\def\thefootnote{\arabic{footnote})}
%\def\art#1{\gdef\@art{#1}}
\def\year#1{\gdef\@year{#1}}
\gdef\StartPage#1{\gdef\@SPage{#1}}
\gdef\EndPage#1{\gdef\@epage{#1}}
\def\vol#1{\gdef\@vol{#1}}
\def\num#1{\gdef\@num{#1}}
\def\dg{\textbf}
\def\abstractname{Abstract}
\gdef\received#1{\gdef\@received{#1}}
\gdef\revised#1{\gdef\@revised{#1}}
%
% Define some fonts
%
% AMSFonts and AMSSymbols
\font\msbmbbs=msbm10
\font\msbmbb=msbm10 scaled \magstep1
\def\Bbb#1{\mbox{\msbmbb\relax#1}}
\def\Bbbs#1{\mbox{\msbmbbs\relax#1}}
\def\JSSAC{\textit{JSS\hspace{-0.2ex}A\hspace{-0.3ex}C} }
%
\newcommand{\C}{\Bbb C}
\newcommand{\R}{\Bbb R}
\newcommand{\Q}{\Bbb Q}
\newcommand{\Z}{\Bbb Z}
\newcommand{\N}{\Bbb N}
\newcommand{\SC}{\hbox{\footnotesize \Bbb C}}
\newcommand{\SR}{\hbox{\footnotesize \Bbb R}}
\newcommand{\SQ}{\hbox{\footnotesize \Bbb Q}}
\newcommand{\SZ}{\hbox{\footnotesize \Bbb Z}}
\newcommand{\SN}{\hbox{\footnotesize \Bbb N}}
\newcommand{\qed}{\hbox{\rule[-2pt]{3pt}{6pt}}}
%
\def\thebibliography#1{
  \section*{\hfil\the@ref\hfill}
  \list {[\arabic{enumi}]}{\settowidth\labelwidth{[#1]}
    \leftmargin\labelwidth
    \advance\leftmargin\labelsep\parsep=0pt
    \usecounter{enumi}}
  \def\newblock{\hskip .11em plus .33em minus .07em}
  \sloppy\clubpenalty4000\widowpenalty4000\sfcode`\.=1000
  \relax}
\def\endthebibliography{\global\advance\@listdepth\m@ne\endtrivlist}
\def\acknowledgements#1{\section*{\hbox to\hsize{\hss\the@ck\hss}}#1}
\def\endacknowledgements{\par}
%%HM addition
\def\ps@eplain{%
  \def\@oddhead{}
  \def\@oddfoot{\footnotesize\hfil{\Roman{PartNumber}-\thepage}\hfil}
}
\def\ps@rims{%
%%HM ...
\ifEditor%
  \def\@oddhead{\setcounter{TotalPage}{\value{page}}%
	\addtocounter{TotalPage}{-1}%
	\addtocounter{TotalPage}{\@SPage}%
%	\footnotesize\hfil\textit{\theTotalPage}
}
  \def\@evenhead{\setcounter{TotalPage}{\value{page}}%
	\addtocounter{TotalPage}{-1}%
	\addtocounter{TotalPage}{\@SPage}%
%	\footnotesize\textit{\theTotalPage}\hfil
}
  \def\@oddfoot{\footnotesize\hfil{\Roman{PartNumber}-\thepage}\hfil}%
  \def\@evenfoot{\footnotesize\hfil{\Roman{PartNumber}-\thepage}\hfil}%
\else
  \def\@oddfoot{\footnotesize\hfil{\thepage}\hfil}%
  \def\@evenfoot{\footnotesize\hfil{\thepage}\hfil}%
\fi
%%... end of HM
}
\def\maketitle{%
  \ifundefined{@year}{\gdef\@year{200X}}{}
  \ifundefined{@vol}{\gdef\@vol{XX}}{}
  \ifundefined{@num}{\gdef\@num{XX}}{}
  \ifundefined{@SPage}{\gdef\@SPage{1}}{}
  \ifundefined{@epage}{\gdef\@epage{XXX}}{}
  \par
  \begingroup
  \def\thefootnote{\fnsymbol{footnote}}%
  \def\@makefnmark{\hbox to 3pt{$^{\@thefnmark}$\hss}}%
  \ifEditor\thispagestyle{eplain}\else\thispagestyle{plain}\fi
  \@maketitle%
  \@thanks%
  \endgroup
  \setcounter{footnote}{0}
  \let\maketitle=\relax
  \let\@maketitle=\relax
  \let\thanks=\relax
  }
\def\@maketitle{%
  \let\mail\thanks
  \null
%  \vbox{
%    \hbox{\footnotesize \textgt{数式処理} \textit{J.\JSSAC (\@year)}%
%      }\vskip -1.5ex
%    \hbox{\footnotesize \textit{Vol.\ \@vol ,\ No.\ \@num ,%
%      \ pp.\ \@SPage\ -\ \@epage}}\vskip 1ex
%    \ifundefined{@art}{\relax}{\hbox{\fbox{\textgt{\@art}}}}
%    }
%  \vskip 2em
  \begin{center}
    {\LARGE \bf \@title \par}\vskip 1.5em
%%HM  \ifundefined{\@etitle}{}%
%%HM    {\Large (\@etitle) \par}\vskip 1.5em%
%%HM    {\Large \lineskip .5em \begin{tabular}[t]{c}\@author\end{tabular}\vskip .5em}
    {\Large \lineskip .5em \begin{tabular}[t]{c}\@author\end{tabular}\vskip .5em}
%    \ifundefined{@received}{}%
%    {\vskip 1.5em \footnotesize\sc (Received \@received %
%      \ifundefined{@revised}{)}{\ \ \footnotesize\sc Revised \@revised)}
%      }
  \end{center}
  \par
  \vskip 1.5em}
\@twosidetrue
%
%% Editors Session
%
\newcounter{PP}
\newcounter{TotalPage}		%%HM
\newcounter{PartNumber}		%%HM
\newif\ifPage%
\newif\ifEditor%
\newif\ifEndWithEvenP%
\IfFileExists{../vol.tex}{\Editortrue}{\Editorfalse}
\IfFileExists{Page.tex}{\Pagetrue}{\Pagefalse \Editorfalse}
\def\NoPage{%
  \newwrite\OutTouch\immediate\openout\OutTouch=NoPage.tex\closeout\OutTouch}
%%HM\def\OddStart{\relax}
\def\ignore#1{{#1}}
\global\let\ndocument\document%
\global\let\nenddocument\enddocument%
\ifEditor
	\input ../vol.tex
\fi
\ifPage
  \input Page.tex
\fi
\ifEditor\EndWithEvenPtrue\else\EndWithEvenPfalse\fi
%%% specification of RIMS
\EndWithEvenPfalse
%%\IfFileExists{headline.tex}{\ifEditor{\include{headline}}\fi}{}
\ifEditor{\typeout{******** Editor Mode ********}%
  \newwrite\OutPut
  \immediate\openout\OutPut=Page.tex
  \gdef\partnumberout#1{%
    \immediate\write\OutPut{\string
      \setcounter{PartNumber}{#1}}}
  \gdef\spageout#1{%
    \immediate\write\OutPut{\string
      \StartPage{#1}}}
  \gdef\epageout#1{%
    \immediate\write\OutPut{\string
      \EndPage{#1}}}
  \long\gdef\document{%
    \ndocument%
    \pagestyle{rims}
    \partnumberout{\thePartNumber}
%%HM    \setcounter{page}{\@SPage}
    \setcounter{TotalPage}{\@SPage}
    \maketitle
%%HM    \spageout{\thepage}}
    \spageout{\theTotalPage}}
  \gdef\enddocument{%
%%HM    \epageout{\thepage}
    \setcounter{TotalPage}{\value{page}}
    \addtocounter{TotalPage}{\@SPage}
    \addtocounter{TotalPage}{-1}
    \epageout{\theTotalPage}
    \closeout\OutPut
%%HM    \IfFileExists{NextOdd.tex}{\ifodd\thepage{\clearpage　}\fi}{}
    \ifEndWithEvenP{\ifodd\value{page}{\clearpage　}\fi}\fi
    \newcount\PP
    \newwrite\Plist
%%HM    \PP=\thepage
    \setcounter{TotalPage}{\value{page}}
    \addtocounter{TotalPage}{\@SPage}
    \addtocounter{TotalPage}{-1}
    \PP=\theTotalPage
    \advance \PP 1
    \immediate\openout\Plist=Next.pp
    \immediate\write\Plist{%
      \number\PP}
    \closeout\Plist
    \nenddocument}
}\fi
%%\etitle{}
\makeatother
