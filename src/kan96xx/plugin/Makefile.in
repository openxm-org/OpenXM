#$OpenXM: OpenXM/src/kan96xx/plugin/Makefile.in,v 1.12 2021/03/24 04:58:32 takayama Exp $
#
#  depends on install-gmp  
#  The source directory of gmp must exist.
#
OpenXM_HOME=@prefix@
OpenXM_include=${OpenXM_HOME}/include
#
OpenXM_HOME_debug=../../..
OpenXM_contrib=${OpenXM_HOME_debug}/../OpenXM_contrib
Kan96xx=..
Gmp_sourcedir=${OpenXM_contrib}/gmp

#AR=/usr/bin/ar
AR=ar
RM=rm
CC=@CC@
RANLIB=@RANLIB@
#CFLAGS+=-g -I${OpenXM_include} -I${Kan96xx}/Kan -D_BSD_SOURCE
CFLAGS=@CFLAGS@ -g -I${OpenXM_include} -I${Kan96xx}/Kan -D_DEFAULT_SOURCE -D_BSD_SOURCE -fcommon

all: configure cmo.a file2.a ox.a sample.a sm1Socket.a  oxxml.a oxcgi.a kstring.a
configure: Makefile

Makefile: Makefile.in
	./configure

cmo.a: cmo.o cmo-gmp.o
	$(AR) ru $@ $?
	${RANLIB} $@

cmo.o: cmo.c cmo.h cmo-gmp.c file2.h mathcap.h cmotag.htmp \
	oxMessageTag.h oxFunctionId.h

cmo-gmp.o: cmo.h cmo.c cmo-gmp.c file2.h mathcap.h cmotag.htmp \
	oxMessageTag.h oxFunctionId.h
	${CC} ${CFLAGS} -I${Gmp_sourcedir} -c cmo-gmp.c

gen-cmotag.htmp: cmotagToName
	$(RM) -f cmotag.htmp
	./cmotagToName > cmotag.htmp

cmotagToName: cmotag.h cmotagToName.c
	${CC} -o cmotagToName cmotagToName.c

cmo.h: cmo0.h cmotag.h
	@echo "Making cmo.h"
	@${RM} -f cmo.h
	@echo "/********* DO NOT EDIT THIS FILE *************/" > cmo.h
	@cat cmotag.h cmo0.h >> cmo.h

file2.a: file2.o
	${AR} ru $@ $?
	${RANLIB} $@

file2.o: file2.h file2.c
	${CC} ${CFLAGS} -I${OpenXM_include} -c file2.c


ox.a: mytcpio.o oxmisc.o oxmisc2.o ${OpenXM_HOME}/lib/mysig.o
	${AR} ru $@ $?
	${RANLIB} $@

ox.h: oxx.h
	@echo "Making ox.h"
	@echo "/********* DO NOT EDIT THIS FILE *************/" > ox.h
	@cat oxx.h >> ox.h

ox.hh: oxx.hh
	@echo "Making ox.hh"
	@$(RM) -f ox.hh
	@echo "/********* DO NOT EDIT THIS FILE *************/" > ox.hh
	@cat oxx.hh >> ox.hh


ox_kan.h: cmotag.h file2.h mathcap.h oxFunctionId.h oxMessageTag.h oxKan0.h ${OpenXM_HOME}/include/mysig.h
	@echo "Making ox_kan.h"
	@$(RM) -f ox_kan.h
	@echo "/********* DO NOT EDIT THIS FILE *************/" > ox_kan.h
	@cat mathcap.h file2.h cmotag.h oxMessageTag.h oxFunctionId.h \
	    oxKan0.h ${OpenXM_HOME}/include/mysig.h >> ox_kan.h

mytcpio.o: ox.h ox.hh ox_kan.h mytcpio.c
oxmisc.o: ox.h ox.hh ox_kan.h oxmisc.c
	${CC} ${CFLAGS} -I${OpenXM_include} -c oxmisc.c
oxmisc2.o: cmo.h mathcap.h ox.h ox.hh ox_kan.h oxmisc2.c

sample.a: sample.o
	${AR} ru $@ $?
	${RANLIB} $@

sample.o: sample.h sample.hh sample.c

sm1Socket.a: sm1Socket.o
	${AR} ru sm1Socket.a sm1Socket.o
	${RANLIB} sm1Socket.a

sm1Socket.o: sm1Socket.h sm1Socket.hh sm1Socket.c

oxxml.a: oxxml.o
	${AR} ru oxxml.a oxxml.o
	${RANLIB} oxxml.a

oxxml.o: oxxml.h oxxml.hh oxxml.c

oxcgi.a: oxcgi.o
	${AR} ru oxcgi.a oxcgi.o
	${RANLIB} oxcgi.a

oxcgi.o: oxcgi.h oxcgi.hh oxcgi.c

kstring.a: kstring.o
	${AR} ru kstring.a kstring.o
	${RANLIB} kstring.a

kstring.o: kstring.h kstring.hh kstring.c


clean:
	${RM} -f *.a *.o a.out cmo.h cmotag.hh cmotagToName  \
		 ox.h ox.hh ox_kan.h
distclean: clean
	${RM} -f Makefile
